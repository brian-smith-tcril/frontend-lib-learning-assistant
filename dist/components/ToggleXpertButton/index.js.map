{"version":3,"file":"index.js","names":["_propTypes","_interopRequireDefault","require","_react","_interopRequireWildcard","_analytics","_auth","_paragon","_icons","_optimizely","_xpertLogo","_experiments","_jsxRuntime","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","obj","ownKeys","keys","getOwnPropertySymbols","o","filter","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","key","value","_toPropertyKey","configurable","writable","_toPrimitive","Symbol","toPrimitive","TypeError","String","Number","ToggleXpert","_ref","isOpen","setIsOpen","courseId","contentToolsEnabled","hasDismissedCTA","setHasDismissedCTA","useState","isModalOpen","setIsModalOpen","target","setTarget","userId","getAuthenticatedUser","decision","usePromptExperimentDecision","enabled","variationKey","experimentPayload","experiment_name","OPTIMIZELY_PROMPT_EXPERIMENT_KEY","variation_key","handleClick","event","sendTrackEvent","course_id","user_id","source","id","localStorage","setItem","handleDismiss","preventDefault","stopPropagation","handleModalClose","shouldDisplayCTA","getItem","chatMargin","jsxs","className","children","jsx","ModalPopup","hasArrow","placement","positionRef","onClose","style","textAlign","gap","ModalCloseButton","variant","Button","onClick","IconButton","src","Close","iconAs","Icon","alt","size","type","ref","ReactComponent","propTypes","PropTypes","bool","isRequired","func","string","_default","exports"],"sources":["../../../src/components/ToggleXpertButton/index.jsx"],"sourcesContent":["import PropTypes from 'prop-types';\nimport React, { useState } from 'react';\nimport { sendTrackEvent } from '@edx/frontend-platform/analytics';\nimport { getAuthenticatedUser } from '@edx/frontend-platform/auth';\nimport {\n  Button,\n  Icon,\n  IconButton,\n  ModalCloseButton,\n  ModalPopup,\n} from '@openedx/paragon';\nimport { Close } from '@openedx/paragon/icons';\n\nimport { OPTIMIZELY_PROMPT_EXPERIMENT_KEY } from '../../data/optimizely';\nimport { ReactComponent as XpertLogo } from '../../assets/xpert-logo.svg';\nimport './index.scss';\nimport { usePromptExperimentDecision } from '../../experiments';\n\nconst ToggleXpert = ({\n  isOpen,\n  setIsOpen,\n  courseId,\n  contentToolsEnabled,\n}) => {\n  const [hasDismissedCTA, setHasDismissedCTA] = useState(false);\n  const [isModalOpen, setIsModalOpen] = useState(true);\n  const [target, setTarget] = useState(null);\n  const { userId } = getAuthenticatedUser();\n\n  const [decision] = usePromptExperimentDecision();\n  const { enabled, variationKey } = decision || {};\n  const experimentPayload = enabled ? {\n    experiment_name: OPTIMIZELY_PROMPT_EXPERIMENT_KEY,\n    variation_key: variationKey,\n  } : {};\n\n  const handleClick = (event) => {\n    // log event if the tool is opened\n    if (!isOpen) {\n      sendTrackEvent(\n        'edx.ui.lms.learning_assistant.launch',\n        {\n          course_id: courseId,\n          user_id: userId,\n          source: event.target.id === 'toggle-button' ? 'toggle' : 'cta',\n          ...experimentPayload,\n        },\n      );\n    }\n    setIsModalOpen(false);\n    localStorage.setItem('completedLearningAssistantTour', 'true');\n    setIsOpen(!isOpen);\n  };\n\n  const handleDismiss = (event) => {\n    // prevent default and propagation to prevent sidebar from opening\n    event.preventDefault();\n    event.stopPropagation();\n    setHasDismissedCTA(true);\n    localStorage.setItem('dismissedLearningAssistantCallToAction', 'true');\n    sendTrackEvent('edx.ui.lms.learning_assistant.dismiss_action_message', {\n      course_id: courseId,\n      ...experimentPayload,\n    });\n  };\n\n  const handleModalClose = () => {\n    localStorage.setItem('completedLearningAssistantTour', 'true');\n    setIsModalOpen(false);\n    sendTrackEvent(\n      'edx.ui.lms.learning_assistant.launch',\n      {\n        course_id: courseId,\n        user_id: userId,\n        source: 'product-tour',\n        ...experimentPayload,\n      },\n    );\n  };\n\n  const shouldDisplayCTA = (\n    (!localStorage.getItem('dismissedLearningAssistantCallToAction') && !hasDismissedCTA)\n    && (localStorage.getItem('completedLearningAssistantTour') || !isModalOpen)\n  );\n\n  const chatMargin = contentToolsEnabled ? 'mb-5' : 'mb-3';\n\n  return (\n    (!isOpen && (\n      <div\n        className={\n          `toggle position-fixed closed d-flex flex-column justify-content-end align-items-end mx-3 border-0\n           ${chatMargin}`\n        }\n        data-testid=\"xpert-toggle\"\n      >\n        <div\n          className=\"position-fixed learning-assistant-popup-modal mb-7\"\n        >\n          <ModalPopup\n            hasArrow\n            placement=\"left\"\n            positionRef={target}\n            isOpen={isModalOpen && !localStorage.getItem('completedLearningAssistantTour')}\n            onClose={handleModalClose}\n          >\n            <div\n              className={`bg-white p-3 rounded shadow border ${chatMargin}`}\n              style={{ textAlign: 'start' }}\n            >\n              <p data-testid=\"modal-message\">\n                Xpert is a new part of your learning experience.<br />\n                You can ask questions and get tutoring help during your course.\n              </p>\n              <div className=\"d-flex justify-content-start\" style={{ gap: '10px' }}>\n                <ModalCloseButton variant=\"outline-primary\" data-testid=\"close-button\">Close</ModalCloseButton>\n                <Button\n                  variant=\"primary\"\n                  className=\"mie-2\"\n                  onClick={handleClick}\n                  data-testid=\"check-button\"\n                >\n                  Check it out\n                </Button>\n              </div>\n            </div>\n          </ModalPopup>\n        </div>\n        { shouldDisplayCTA && (\n          <div\n            className=\"d-flex justify-content-end flex-row \"\n            data-testid=\"action-message\"\n          >\n            <IconButton\n              src={Close}\n              iconAs={Icon}\n              alt=\"dismiss\"\n              onClick={handleDismiss}\n              variant=\"light\"\n              className=\"dismiss-button mx-2 mt-1 bg-gray\"\n              size=\"sm\"\n              data-testid=\"dismiss-button\"\n            />\n            <button\n              className=\"action-message open-negative-margin p-3 mb-4.5\"\n              data-testid=\"message-button\"\n              onClick={handleClick}\n              aria-label=\"Can I answer any questions for you?\"\n              type=\"button\"\n              id=\"cta-button\"\n            >\n              <span>\n                Hi there! ðŸ‘‹ I&apos;m Xpert,\n                an AI-powered assistant from edX who can help you with questions about this course.\n              </span>\n            </button>\n          </div>\n        )}\n        <Button\n          variant=\"primary\"\n          className=\"toggle button-icon\"\n          data-testid=\"toggle-button\"\n          onClick={handleClick}\n          id=\"toggle-button\"\n          ref={setTarget}\n        >\n          <XpertLogo />\n        </Button>\n      </div>\n    ))\n  );\n};\n\nToggleXpert.propTypes = {\n  isOpen: PropTypes.bool.isRequired,\n  setIsOpen: PropTypes.func.isRequired,\n  courseId: PropTypes.string.isRequired,\n  contentToolsEnabled: PropTypes.bool.isRequired,\n};\n\nexport default ToggleXpert;\n"],"mappings":"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","ignoreList":[]}